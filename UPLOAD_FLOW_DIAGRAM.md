# Upload Flow Diagrams

## ğŸ¬ Regular Upload (< 100MB)

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Frontend  â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ POST {API}/files/upload
       â”‚ (FormData with file)
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚   Backend   â”‚
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ Validate file
       â”‚ Upload to B2
       â”‚ Save to DB
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Response   â”‚
â”‚  file URL   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¥ Chunked Upload (> 100MB, up to 10GB)

### Full Flow Diagram

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                              â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ 1. User selects video file
                            â–¼
                   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                   â”‚ Calculate      â”‚
                   â”‚ - totalChunks  â”‚ totalChunks = Math.ceil(fileSize / 5MB)
                   â”‚ - totalSize    â”‚
                   â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ 2. POST {API}/files/chunk/initiate
                            â”‚    { originalName, mimeType, totalSize, totalChunks }
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Validate video type & size                          â”‚  â”‚
â”‚  â”‚ 2. Generate unique filename                            â”‚  â”‚
â”‚  â”‚ 3. Create S3 multipart upload â†’ Get uploadId          â”‚  â”‚
â”‚  â”‚ 4. Save session to MongoDB (ChunkUpload model)        â”‚  â”‚
â”‚  â”‚ 5. Set expiration: now + 24 hours                      â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Response: { uploadId, fileName, chunkSize }
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ FOR LOOP: i = 0 to totalChunks - 1                    â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚   3. Slice chunk from file (5MB)                      â”‚  â”‚
â”‚  â”‚      chunk = file.slice(i * 5MB, (i+1) * 5MB)        â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â”‚   4. POST {API}/files/chunk/upload                     â”‚  â”‚
â”‚  â”‚      FormData: { uploadId, partNumber: i+1, chunk }   â”‚  â”‚
â”‚  â”‚        â”‚                                               â”‚  â”‚
â”‚  â”‚        â–¼                                               â”‚  â”‚
â”‚  â”‚   â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚  â”‚
â”‚  â”‚   â”‚ BACKEND                                  â”‚        â”‚  â”‚
â”‚  â”‚   â”‚ - Find upload session                    â”‚        â”‚  â”‚
â”‚  â”‚   â”‚ - Upload chunk to S3 â†’ Get ETag         â”‚        â”‚  â”‚
â”‚  â”‚   â”‚ - Save part info to MongoDB              â”‚        â”‚  â”‚
â”‚  â”‚   â”‚ - Update uploadedChunks counter          â”‚        â”‚  â”‚
â”‚  â”‚   â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚  â”‚
â”‚  â”‚                â”‚                                       â”‚  â”‚
â”‚  â”‚                â”‚ Response: { partNumber, eTag,        â”‚  â”‚
â”‚  â”‚                â”‚            uploadedChunks,           â”‚  â”‚
â”‚  â”‚                â”‚            totalChunks }             â”‚  â”‚
â”‚  â”‚                â–¼                                       â”‚  â”‚
â”‚  â”‚   5. Update progress UI                               â”‚  â”‚
â”‚  â”‚      progress = uploadedChunks / totalChunks * 100   â”‚  â”‚
â”‚  â”‚                                                         â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â”‚                    â”‚ (Loop continues until all chunks done) â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                     â”‚
                     â”‚ All chunks uploaded!
                     â”‚
                     â”‚ 6. POST {API}/files/chunk/complete
                     â”‚    { uploadId }
                     â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         BACKEND                               â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 1. Verify all chunks uploaded                          â”‚  â”‚
â”‚  â”‚ 2. Call S3 CompleteMultipartUpload                     â”‚  â”‚
â”‚  â”‚    - S3 merges all chunks into single file             â”‚  â”‚
â”‚  â”‚ 3. Save file metadata to File collection               â”‚  â”‚
â”‚  â”‚ 4. Mark upload session as "completed"                  â”‚  â”‚
â”‚  â”‚ 5. Return file URL                                     â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â”‚
                            â”‚ Response: { id, fileUrl, fileSize, ... }
                            â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                         FRONTEND                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”‚
â”‚  â”‚ 7. Show success message                                â”‚  â”‚
â”‚  â”‚ 8. Display video player with fileUrl                   â”‚  â”‚
â”‚  â”‚ 9. Save file metadata for later use                    â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ“Š Detailed Chunk Upload Sequence

```
Frontend                    Backend                      Backblaze B2
   â”‚                           â”‚                              â”‚
   â”‚â”€â”€1. INITIATEâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                              â”‚
   â”‚                           â”‚â”€â”€Create Multipart Uploadâ”€â”€â”€â”€â–¶â”‚
   â”‚                           â”‚â—€â”€â”€â”€â”€â”€uploadIdâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚â—€â”€â”€uploadIdâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                           â”‚                              â”‚
   â”‚â”€â”€2. UPLOAD CHUNK 1â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                              â”‚
   â”‚   (5MB, part 1)           â”‚â”€â”€Upload Part 1â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚                           â”‚â—€â”€â”€â”€â”€â”€ETag 1â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚â—€â”€â”€Progress: 1/100â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                           â”‚                              â”‚
   â”‚â”€â”€3. UPLOAD CHUNK 2â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                              â”‚
   â”‚   (5MB, part 2)           â”‚â”€â”€Upload Part 2â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚                           â”‚â—€â”€â”€â”€â”€â”€ETag 2â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚â—€â”€â”€Progress: 2/100â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                           â”‚                              â”‚
   â”‚         ...               â”‚         ...                  â”‚
   â”‚                           â”‚                              â”‚
   â”‚â”€â”€N. UPLOAD CHUNK 100â”€â”€â”€â”€â”€â”€â–¶â”‚                              â”‚
   â”‚   (last chunk)            â”‚â”€â”€Upload Part 100â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚
   â”‚                           â”‚â—€â”€â”€â”€â”€â”€ETag 100â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚â—€â”€â”€Progress: 100/100â”€â”€â”€â”€â”€â”€â”€â”‚                              â”‚
   â”‚                           â”‚                              â”‚
   â”‚â”€â”€N+1. COMPLETEâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶â”‚                              â”‚
   â”‚                           â”‚â”€â”€Complete Multipart Uploadâ”€â”€â–¶â”‚
   â”‚                           â”‚  (merge all 100 parts)       â”‚
   â”‚                           â”‚â—€â”€â”€â”€â”€â”€File URLâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”‚
   â”‚â—€â”€â”€File URL & metadataâ”€â”€â”€â”€â”‚                              â”‚
   â”‚                           â”‚                              â”‚
```

---

## ğŸ”„ State Transitions

```
Upload Session States:

â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  initiated â”‚  â† Upload session created, no chunks yet
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”‚ First chunk uploaded
       â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ uploading  â”‚  â† At least 1 chunk uploaded
â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€ All chunks uploaded + Complete called â”€â”€â”€â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                        â”‚ completed â”‚
       â”‚                                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â”œâ”€â”€â”€â”€â”€â”€â”€â”€ User cancels â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
       â”‚                                                        â”‚  aborted  â”‚
       â”‚                                                        â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
       â”‚
       â””â”€â”€â”€â”€â”€â”€â”€â”€ Error occurs â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â–¶ â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                                                                â”‚  failed   â”‚
                                                                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ’¾ Data Flow

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    CLIENT (Browser)                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                                           â”‚
â”‚  â”‚ Video File   â”‚  10GB file                                â”‚
â”‚  â”‚ "movie.mp4"  â”‚                                           â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”˜                                           â”‚
â”‚         â”‚                                                    â”‚
â”‚         â”‚ Split into 2000 chunks                            â”‚
â”‚         â–¼                                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                    â”‚
â”‚  â”‚ Chunk 1 â”‚ Chunk 2 â”‚ ... â”‚ Chunk 2000â”‚  (5MB each)       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Upload one at a time
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                    SERVER (Express)                         â”‚
â”‚                                                              â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”               â”‚
â”‚  â”‚ ChunkUpload Collection (MongoDB)         â”‚               â”‚
â”‚  â”‚                                           â”‚               â”‚
â”‚  â”‚ {                                         â”‚               â”‚
â”‚  â”‚   uploadId: "xyz123",                    â”‚               â”‚
â”‚  â”‚   userId: "user_id",                     â”‚               â”‚
â”‚  â”‚   fileName: "files/user/movie.mp4",      â”‚               â”‚
â”‚  â”‚   totalChunks: 2000,                     â”‚               â”‚
â”‚  â”‚   uploadedChunks: 1500,  â† Updates      â”‚               â”‚
â”‚  â”‚   parts: [                               â”‚               â”‚
â”‚  â”‚     { partNumber: 1, eTag: "...", ... }, â”‚               â”‚
â”‚  â”‚     { partNumber: 2, eTag: "...", ... }, â”‚               â”‚
â”‚  â”‚     ...                                  â”‚               â”‚
â”‚  â”‚   ],                                     â”‚               â”‚
â”‚  â”‚   status: "uploading"                    â”‚               â”‚
â”‚  â”‚ }                                        â”‚               â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                        â”‚
                        â”‚ Forward to S3 API
                        â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 BACKBLAZE B2 (Storage)                      â”‚
â”‚                                                              â”‚
â”‚  Multipart Upload Session                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ Part 1: 5MB  âœ… Uploaded               â”‚                 â”‚
â”‚  â”‚ Part 2: 5MB  âœ… Uploaded               â”‚                 â”‚
â”‚  â”‚ Part 3: 5MB  âœ… Uploaded               â”‚                 â”‚
â”‚  â”‚ ...                                    â”‚                 â”‚
â”‚  â”‚ Part 1999: 5MB  â³ Pending             â”‚                 â”‚
â”‚  â”‚ Part 2000: 3MB  â³ Pending             â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â”‚                                                              â”‚
â”‚  After Complete:                                            â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                 â”‚
â”‚  â”‚ âœ… Final File: movie.mp4 (10GB)        â”‚                 â”‚
â”‚  â”‚ Public URL: https://b2.../movie.mp4    â”‚                 â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¯ Request/Response Flow

### Initiate Request

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST {API}/files/chunk/initiate       â”‚
â”‚                                      â”‚
â”‚ Headers:                             â”‚
â”‚   Authorization: Bearer <token>     â”‚
â”‚   Content-Type: application/json    â”‚
â”‚                                      â”‚
â”‚ Body:                                â”‚
â”‚ {                                    â”‚
â”‚   "originalName": "video.mp4",      â”‚
â”‚   "mimeType": "video/mp4",          â”‚
â”‚   "totalSize": 524288000,           â”‚
â”‚   "totalChunks": 100                â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response 201 Created                 â”‚
â”‚                                      â”‚
â”‚ {                                    â”‚
â”‚   "success": true,                  â”‚
â”‚   "data": {                         â”‚
â”‚     "uploadId": "xyz123",           â”‚
â”‚     "fileName": "files/...",        â”‚
â”‚     "chunkSize": 5242880            â”‚
â”‚   }                                  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Upload Chunk Request

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST {API}/files/chunk/upload         â”‚
â”‚                                      â”‚
â”‚ Headers:                             â”‚
â”‚   Authorization: Bearer <token>     â”‚
â”‚   Content-Type: multipart/form-data â”‚
â”‚                                      â”‚
â”‚ FormData:                            â”‚
â”‚   uploadId: "xyz123"                â”‚
â”‚   partNumber: "1"                   â”‚
â”‚   chunk: <Binary 5MB blob>          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response 200 OK                      â”‚
â”‚                                      â”‚
â”‚ {                                    â”‚
â”‚   "success": true,                  â”‚
â”‚   "data": {                         â”‚
â”‚     "partNumber": 1,                â”‚
â”‚     "eTag": "d41d8cd...",           â”‚
â”‚     "uploadedChunks": 1,            â”‚
â”‚     "totalChunks": 100              â”‚
â”‚   }                                  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### Complete Request

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ POST {API}/files/chunk/complete       â”‚
â”‚                                      â”‚
â”‚ Headers:                             â”‚
â”‚   Authorization: Bearer <token>     â”‚
â”‚   Content-Type: application/json    â”‚
â”‚                                      â”‚
â”‚ Body:                                â”‚
â”‚ {                                    â”‚
â”‚   "uploadId": "xyz123"              â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ Response 200 OK                      â”‚
â”‚                                      â”‚
â”‚ {                                    â”‚
â”‚   "success": true,                  â”‚
â”‚   "data": {                         â”‚
â”‚     "id": "507f1f77...",            â”‚
â”‚     "fileName": "files/...",        â”‚
â”‚     "fileUrl": "https://...",       â”‚
â”‚     "fileSize": 524288000           â”‚
â”‚   }                                  â”‚
â”‚ }                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ§® Chunk Calculation Examples

### Example 1: 50MB Video

```
File size: 50MB = 52,428,800 bytes
Chunk size: 5MB = 5,242,880 bytes

Total chunks = Math.ceil(52,428,800 / 5,242,880)
             = Math.ceil(10)
             = 10 chunks

Chunk breakdown:
- Chunks 1-9: 5MB each
- Chunk 10: 52,428,800 - (9 Ã— 5,242,880) = 5,242,880 bytes (5MB)
```

### Example 2: 523MB Video

```
File size: 523MB = 548,405,248 bytes
Chunk size: 5MB = 5,242,880 bytes

Total chunks = Math.ceil(548,405,248 / 5,242,880)
             = Math.ceil(104.6)
             = 105 chunks

Chunk breakdown:
- Chunks 1-104: 5MB each
- Chunk 105: 548,405,248 - (104 Ã— 5,242,880) = 3,148,928 bytes (~3MB)
```

### Example 3: 10GB Video

```
File size: 10GB = 10,737,418,240 bytes
Chunk size: 5MB = 5,242,880 bytes

Total chunks = Math.ceil(10,737,418,240 / 5,242,880)
             = Math.ceil(2048)
             = 2048 chunks

Chunk breakdown:
- Chunks 1-2048: 5MB each
- All chunks are exactly 5MB (10GB is divisible by 5MB)
```

---

## â±ï¸ Upload Time Estimates

Assuming 10 Mbps upload speed:

| File Size | Chunks | Estimated Time |
| --------- | ------ | -------------- |
| 100MB     | 20     | ~1.5 minutes   |
| 500MB     | 100    | ~7 minutes     |
| 1GB       | 205    | ~14 minutes    |
| 2GB       | 410    | ~28 minutes    |
| 5GB       | 1024   | ~70 minutes    |
| 10GB      | 2048   | ~140 minutes   |

_Note: Actual times vary based on network speed, server load, and B2 performance_

---

## ğŸš¨ Error Scenarios

### Scenario 1: Network Interruption

```
Frontend uploading chunk 45/100
        â”‚
        â”‚ Network drops
        â–¼
Upload fails at chunk 45
        â”‚
        â”‚ User refreshes page
        â–¼
GET {API}/files/chunk/status/:uploadId
        â”‚
        â”‚ Response: uploadedChunks = 44
        â–¼
Resume from chunk 45
```

### Scenario 2: Session Expiration

```
Upload started: Jan 1, 2025 10:00 AM
Session expires: Jan 2, 2025 10:00 AM (24 hours)
        â”‚
        â”‚ User tries to upload chunk on Jan 3
        â–¼
Error 404: Upload session not found
        â”‚
        â”‚ Solution: Restart upload
        â–¼
POST {API}/files/chunk/initiate (start over)
```

### Scenario 3: Incomplete Upload

```
Total chunks: 100
Uploaded: 95 chunks
        â”‚
        â”‚ User calls COMPLETE
        â–¼
Error 400: Not all chunks uploaded
        â”‚
        â”‚ Response: Expected 100, got 95
        â–¼
Upload remaining 5 chunks, then complete
```

---

This diagram should help your frontend team visualize the entire upload process!
